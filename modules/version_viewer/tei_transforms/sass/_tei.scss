/**
 * @file
 * Sass partial to handle TEI display.
 */

// Size of the text indent.
$indent:  .5in;

// Size of left and right margins content.
$margin: 15%;

// Grey used for deleted/damaged/unclear text.
$grey: #7f7f7f;

// Highlight colour.
$highlight: yellow;

// Characters used for quotes.
$single_quote: "'";
$double_quote: '"';

// Line height.
// XXX: Could get into trouble here, if the font size is ever changed.
$line_height: 3em;

.tei {
  // Reset elements inside our TEI wrapper.
  @import "compass/reset";

  margin: $margin;
  margin-top: $indent;
  margin-bottom: $indent;
  color: black;
  .p, p.epigraph {
    text-indent: $indent * 1;
  }

  & > div {
    position: relative;
    line-height: $line_height;
    margin-right: auto;
    margin-left: auto;

    & > div.line-magic {
      position: relative;
      z-index: 2;
      top: 0;
      .class--place--superlinear, .class--place--sublinear {
        visibility: hidden;
      }
    }
    & > div.super-magic {
      position: absolute;
      top: -($line_height / 3);
      left: 0;
      z-index: 1;
      * {
        visibility: hidden;
      }
      .class--place--superlinear {
        visibility: visible;
      }
    }
    & > div.sub-magic {
      top:  $line_height / 3;
      left: 0;
      position: absolute;
      z-index: 1;
      * {
        visibility: hidden;
      }
      .class--place--sublinear {
        visibility: visible;
      }
    }
  }

  .byline {
    display: block;
    text-indent: $indent;
    font-style: italic;
    margin-bottom: 0.5em;
  }

  // Text styles and alignment.
  .class--rend--bold {
    font-weight: bold;
  }
  .class--rend--italic {
    font-style: italic;
  }
  .class--rend--underline {
    text-decoration: underline;
  }
  .class--rend--center {
    text-align: center;
  }
  .class--rend--right {
    text-align: right;
  }
  .class--rend--left {
    text-align: left;
  }
  .class--rend--small-caps {
    font-variant: small-caps;
  }
  .class--rend--strikethrough {
    text-decoration: line-through;
    color: $grey;
  }
  .class--rend--superscript {
    vertical-align: super;
    font-size: smaller;
  }
  .class--rend--subscript {
    vertical-align: sub;
    font-size: smaller;
  }

  // Quotations.
  q.class--style--single {
    &:before, &:after {
      content: $single_quote;
    }
  }
  q:not(.class--style--single) {
    &:before, &:after {
      content: $double_quote;
    }
  }

  .unclear, .damage {
    color: $grey;

    &.class--rend--illegible,
    &.class--rend--inaudible,
    &.class--reason--illegible,
    &.class--reason--inaudible {
      &:before {
        content: "<";
      }
      &:after {
        content: ">";
      }
    }
  }

  .head {
    font-size: larger;
  }
  .label {
    @extend .head;
    margin-top: .5em;
    text-indent: 0;
  }

  .hi {
    background-color: $highlight;
  }

  // Indentation.
  .class--rend--no-indent,
  .class--rend--no_indent {
    text-indent: $indent * 0;
  }
  .class--rend--indent1 {
    text-indent: $indent * 1;
  }
  .class--rend--indent2 {
    text-indent: $indent * 2;
  }
  .class--rend--indent3 {
    text-indent: $indent * 3;
  }
  .class--rend--indent4 {
    text-indent: $indent * 4;
  }
  .listBibl {
    .bibl {
      padding-left: $indent;
      text-indent: -$indent;
    }
  }

  .list {
    list-style-position: inside;

    &.class--type--ordered {
      list-style-type: decimal;
    }
    &.class--type--bulleted {
      list-style-type: disc;
    }
  }

  ul.lg.class--type--stanza > li {
    text-indent: $indent;
  }

  @mixin margin_base($direction) {
    $margin_padding: 0.1;
    $margin_width: ($margin * 100%) / (100% - (2 * $margin));
    $margin_offset: -$margin_width * (1 - (1 * $margin_padding));

    @if $direction == left {
      margin-left: $margin_offset;
    } @elseif $direction == right {
      margin-right: $margin_offset;
    }

    float: $direction;
    clear: $direction;
    text-indent: 0;
    width: $margin_width * (1 - (2 * $margin_padding));
    word-wrap: break-word;
  }
  .class--place--left_margin {
    @include margin_base(left);
  }
  .class--place--right_margin {
    @include margin_base(right);
  }

  *:not(dt) > a.note.class--place--footnote {
    vertical-align: super;
    font-size: smaller;
  }

  footer {
    border-top: thin solid black;
    margin-top: 1em;
    padding-top: 1em;
    dl {
      dt {
        float: left;
        clear: left;
      }
      dd {
        margin-left: $indent;
        text-indent: -$indent;
        float: left;
        &:before {
          content: ":";
          padding-right: .5 * $indent;
        }
      }
    }
  }
}
